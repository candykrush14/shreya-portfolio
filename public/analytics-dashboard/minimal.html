<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Analytics Dashboard - Fixed</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="root">Loading...</div>
    
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useRef, useMemo } = React;

        // Sample data
        const SAMPLE_DATA = [
            { month: 'Jan', revenue: 50000, users: 1200, conversion: 3.5, category: 'Technology', growth: '5.0', satisfaction: '85.0' },
            { month: 'Feb', revenue: 55000, users: 1350, conversion: 4.2, category: 'Healthcare', growth: '10.0', satisfaction: '87.5' },
            { month: 'Mar', revenue: 48000, users: 1180, conversion: 3.8, category: 'Finance', growth: '-12.7', satisfaction: '82.1' },
            { month: 'Apr', revenue: 62000, users: 1450, conversion: 4.8, category: 'Retail', growth: '29.2', satisfaction: '89.3' },
            { month: 'May', revenue: 58000, users: 1320, conversion: 4.5, category: 'Education', growth: '-6.5', satisfaction: '88.7' },
            { month: 'Jun', revenue: 65000, users: 1520, conversion: 5.1, category: 'Technology', growth: '12.1', satisfaction: '91.2' }
        ];

        // Context
        const AnalyticsContext = createContext();

        const AnalyticsProvider = ({ children }) => {
            const [data, setData] = useState(SAMPLE_DATA);
            const [isLoading, setIsLoading] = useState(false);

            const value = {
                data,
                setData,
                isLoading
            };

            return React.createElement(AnalyticsContext.Provider, { value }, children);
        };

        const useAnalytics = () => {
            const context = useContext(AnalyticsContext);
            if (!context) {
                throw new Error('useAnalytics must be used within AnalyticsProvider');
            }
            return context;
        };

        // Components
        const Header = () => {
            return React.createElement('header', {
                className: 'bg-white shadow-sm border-b'
            },
                React.createElement('div', {
                    className: 'max-w-7xl mx-auto px-6 py-4'
                },
                    React.createElement('h1', {
                        className: 'text-2xl font-bold text-gray-900'
                    }, 'ðŸ¤– AI Analytics Dashboard'),
                    React.createElement('p', {
                        className: 'text-gray-600 mt-1'
                    }, 'Advanced data visualization and AI-powered insights')
                )
            );
        };

        const MetricsCards = () => {
            const { data } = useAnalytics();

            if (!data || data.length === 0) {
                return React.createElement('div', { className: 'text-center py-8' }, 'No data available');
            }

            const metrics = [
                { 
                    title: 'Total Revenue', 
                    value: `$${data.reduce((sum, item) => sum + item.revenue, 0).toLocaleString()}`, 
                    icon: 'ðŸ’°' 
                },
                { 
                    title: 'Total Users', 
                    value: data.reduce((sum, item) => sum + item.users, 0).toLocaleString(), 
                    icon: 'ðŸ‘¥' 
                },
                { 
                    title: 'Avg Conversion', 
                    value: `${(data.reduce((sum, item) => sum + item.conversion, 0) / data.length).toFixed(1)}%`, 
                    icon: 'ðŸ“ˆ' 
                },
                { 
                    title: 'Avg Satisfaction', 
                    value: `${(data.reduce((sum, item) => sum + parseFloat(item.satisfaction), 0) / data.length).toFixed(1)}%`, 
                    icon: 'ðŸ˜Š' 
                }
            ];

            return React.createElement('div', {
                className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8'
            }, metrics.map(metric => 
                React.createElement('div', {
                    key: metric.title,
                    className: 'bg-white p-6 rounded-lg shadow-sm border'
                },
                    React.createElement('div', {
                        className: 'flex items-center justify-between mb-4'
                    },
                        React.createElement('span', {
                            className: 'text-2xl'
                        }, metric.icon),
                        React.createElement('span', {
                            className: 'text-green-500 text-sm font-medium'
                        }, '+5.2%')
                    ),
                    React.createElement('h3', {
                        className: 'text-gray-600 text-sm font-medium mb-2'
                    }, metric.title),
                    React.createElement('p', {
                        className: 'text-2xl font-bold text-gray-900'
                    }, metric.value)
                )
            ));
        };

        const SimpleChart = () => {
            const { data } = useAnalytics();
            const svgRef = useRef();

            useEffect(() => {
                if (!data || data.length === 0) return;

                const svg = d3.select(svgRef.current);
                svg.selectAll("*").remove();

                const margin = { top: 20, right: 30, bottom: 40, left: 50 };
                const width = 400 - margin.left - margin.right;
                const height = 250 - margin.top - margin.bottom;

                const g = svg.append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const xScale = d3.scaleBand()
                    .domain(data.map(d => d.month))
                    .range([0, width])
                    .padding(0.1);

                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.revenue)])
                    .range([height, 0]);

                g.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", d => xScale(d.month))
                    .attr("width", xScale.bandwidth())
                    .attr("y", d => yScale(d.revenue))
                    .attr("height", d => height - yScale(d.revenue))
                    .attr("fill", "#4F46E5");

                g.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(xScale));

                g.append("g")
                    .call(d3.axisLeft(yScale));

            }, [data]);

            return React.createElement('div', {
                className: 'bg-white p-6 rounded-lg shadow-sm border'
            },
                React.createElement('h3', {
                    className: 'text-lg font-semibold mb-4'
                }, 'ðŸ“Š Revenue Trend'),
                React.createElement('svg', {
                    ref: svgRef,
                    width: 400,
                    height: 250
                })
            );
        };

        const Dashboard = () => {
            const { data, isLoading } = useAnalytics();

            if (isLoading) {
                return React.createElement('div', {
                    className: 'min-h-screen flex items-center justify-center'
                },
                    React.createElement('div', {
                        className: 'text-center'
                    },
                        React.createElement('div', {
                            className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4'
                        }),
                        React.createElement('p', {
                            className: 'text-gray-600'
                        }, 'Loading...')
                    )
                );
            }

            return React.createElement('div', {
                className: 'min-h-screen bg-gray-50'
            },
                React.createElement(Header),
                React.createElement('main', {
                    className: 'max-w-7xl mx-auto p-6'
                },
                    React.createElement(MetricsCards),
                    React.createElement('div', {
                        className: 'grid lg:grid-cols-2 gap-6'
                    },
                        React.createElement(SimpleChart),
                        React.createElement('div', {
                            className: 'bg-white p-6 rounded-lg shadow-sm border'
                        },
                            React.createElement('h3', {
                                className: 'text-lg font-semibold mb-4'
                            }, 'ðŸ§  AI Insights'),
                            React.createElement('div', {
                                className: 'space-y-3'
                            },
                                React.createElement('div', {
                                    className: 'p-3 bg-blue-50 rounded-lg'
                                },
                                    React.createElement('p', {
                                        className: 'text-sm text-blue-800'
                                    }, 'ðŸ’¡ Revenue shows strong upward trend with 15% growth')
                                ),
                                React.createElement('div', {
                                    className: 'p-3 bg-green-50 rounded-lg'
                                },
                                    React.createElement('p', {
                                        className: 'text-sm text-green-800'
                                    }, 'ðŸ“ˆ User engagement improved by 12% this quarter')
                                ),
                                React.createElement('div', {
                                    className: 'p-3 bg-purple-50 rounded-lg'
                                },
                                    React.createElement('p', {
                                        className: 'text-sm text-purple-800'
                                    }, 'ðŸŽ¯ Conversion rate optimization showing positive results')
                                )
                            )
                        )
                    )
                )
            );
        };

        // App
        const App = () => {
            return React.createElement(AnalyticsProvider, null,
                React.createElement(Dashboard)
            );
        };

        // Render
        console.log('Starting React app...');
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
        console.log('React app rendered successfully!');
    </script>
</body>
</html>
